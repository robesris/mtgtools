<!DOCTYPE html>
<html>
<head>
  <title>Commander Game Changers List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      gap: 20px;
      position: relative;
      width: 100%;
      box-sizing: border-box;
    }
    .color-filter-tray {
      width: 200px;
      min-width: 200px;
      max-width: 200px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 15px;
      position: sticky;
      top: 20px;
      height: fit-content;
      transition: width 0.3s ease, min-width 0.3s ease, max-width 0.3s ease, padding 0.3s ease;
      z-index: 1;
      flex-shrink: 0;
    }
    .color-filter-tray.collapsed {
      width: 30px;
      min-width: 30px;
      max-width: 30px;
      padding: 15px 5px;
    }
    .color-filter-tray .filter-content {
      opacity: 1;
      visibility: visible;
      transition: opacity 0.2s ease, visibility 0.2s, width 0.3s ease;
      width: 100%;
      padding: 5px 0;
      display: flex;
      flex-direction: column;
      gap: 15px;
      min-width: 0;
    }
    .color-filter-tray.collapsed .filter-content {
      opacity: 0;
      visibility: hidden;
      width: 0;
      min-width: 0;
      padding: 0;
    }
    .color-filter-tray .toggle-button {
      position: absolute;
      right: -30px;
      top: 50%;
      transform: translateY(-50%);
      background: white;
      border: none;
      border-radius: 0 4px 4px 0;
      padding: 10px;
      cursor: pointer;
      box-shadow: 2px 0 4px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
      width: 30px;
      height: 30px;
      transition: all 0.3s ease;
      font-size: 0; /* Hide any text content */
    }
    .color-filter-tray.collapsed .toggle-button {
      transform: translateY(-50%);
      right: -30px;
      border-radius: 0 4px 4px 0;
      box-shadow: 2px 0 4px rgba(0,0,0,0.1);
      background: white;
      border: none;
    }
    .color-filter-tray .toggle-button::before {
      content: "‚ñ∂";
      font-size: 12px;
      line-height: 1;
      transition: transform 0.3s ease;
    }
    .color-filter-tray.collapsed .toggle-button::before {
      transform: rotate(180deg);
    }
    .color-filter-tray label {
      position: relative;
      display: block;
      cursor: pointer;
      width: 100%;
      height: 32px;  /* Fixed height */
      margin: 0;  /* Remove margin */
      padding: 0;  /* Remove padding */
      border-radius: 4px;
      transition: background-color 0.2s;
      box-sizing: border-box;
      overflow: hidden;  /* Prevent content from affecting layout */
    }
    .color-filter-tray label:last-child {
      margin: 0;
    }
    .color-filter-tray label:hover {
      background-color: #f5f5f5;
    }
    .color-filter-tray label input[type="checkbox"] {
      position: absolute;
      left: 5px;
      top: 50%;
      transform: translateY(-50%);
      margin: 0;
      width: 16px;
      height: 16px;
      z-index: 2;
      pointer-events: auto;
    }
    .color-filter-tray label span:not(.only-icon) {
      position: absolute;
      left: 29px;  /* checkbox width + padding */
      right: 29px;  /* eye icon width + padding */
      top: 50%;
      transform: translateY(-50%);
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      z-index: 1;
      pointer-events: none;  /* Prevent text from interfering with clicks */
    }
    .color-filter-tray .only-icon {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
      width: 20px;
      height: 20px;  /* Fixed height */
      line-height: 20px;  /* Center the eye icon vertically */
      text-align: center;
      z-index: 2;
      pointer-events: auto;
      user-select: none;  /* Prevent text selection */
      -webkit-user-select: none;
    }
    .color-filter-tray .only-icon:hover {
      opacity: 1;
    }
    .card-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 20px;
      margin-top: 20px;
      margin-left: 20px; /* Increased from 10px to 20px to prevent overlap */
      align-items: start;
      width: 100%;
      box-sizing: border-box;
      min-width: 0;
    }
    .card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: transform 0.2s, opacity 0.3s, visibility 0.3s;
      width: 100%;
      box-sizing: border-box;
      min-width: 0;
      opacity: 1;
      visibility: visible;
    }
    .card.hidden-by-color {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      position: absolute;
    }
    .card.hidden-by-all {
      display: none;
    }
    .card:hover {
      transform: translateY(-5px);
    }
    .card-image-container {
      width: 100%;
      position: relative;
      padding-top: 139.7%; /* Magic card aspect ratio (3.5:2.5) */
    }
    .card img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .card-name {
      font-weight: bold;
      color: #333;
      font-size: 1.1em;
      margin: 10px 0;
      padding: 0 5px;
      width: 100%;
      box-sizing: border-box;
    }
    .price-info {
      margin-top: 10px;
      font-size: 0.9em;
      color: #666;
      width: 100%;
      text-align: left;
      padding: 0 5px;
    }
    .price-info a {
      color: #0066cc;
      text-decoration: none;
    }
    .price-info a:hover {
      text-decoration: underline;
    }
    /* Make timestamp styling more specific and forceful */
    .price-info .price-timestamp {
      display: block;
      font-size: 0.65em !important;
      margin-top: 4px;
      font-style: italic;
      line-height: 1.2;
      color: #666;
    }
    .price-info .price-timestamp.recent {
      color: #2ecc71 !important;
    }
    .price-info .price-timestamp.old {
      color: #e67e22 !important;
    }
    .price-info .price-timestamp.very-old {
      color: #e74c3c !important;
    }
    .loading {
      color: #999;
      font-style: italic;
    }
    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 30px;
      padding: 0 20px;
    }
    .source {
      text-align: center;
      margin-top: 30px;
      color: #666;
      font-size: 0.9em;
      padding: 0 20px;
    }
    .not-found {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #666;
      font-style: italic;
      padding: 15px;
      background: #f8f8f8;
      border-radius: 4px;
      width: 80%;
      text-align: center;
    }
    @media (max-width: 1400px) {
      .card-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));  /* 3 columns on medium screens */
      }
    }
    @media (max-width: 1000px) {
      .card-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));  /* 2 columns on smaller screens */
      }
    }
    @media (max-width: 600px) {
      .card-grid {
        grid-template-columns: repeat(1, minmax(0, 1fr));  /* 1 column on mobile */
      }
      .card {
        padding: 10px;
      }
      .card-name {
        font-size: 1em;
      }
    }
    /* Inserted CSS for filter tray color labels */
    .filter-text-white { background: #fff; color: #333; border: 1px solid #ddd; border-radius: 4px; padding: 2px 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.03); }
    .filter-text-blue { background: #0070BA; color: #fff; border-radius: 4px; padding: 2px 8px; }
    .filter-text-black { background: #150B00; color: #fff; border-radius: 4px; padding: 2px 8px; }
    .filter-text-red { background: #D3202A; color: #fff; border-radius: 4px; padding: 2px 8px; }
    .filter-text-green { background: #00733E; color: #fff; border-radius: 4px; padding: 2px 8px; }
    .filter-text-multicolor { background: linear-gradient(90deg, #150B00 0%, #0070BA 25%, #D3202A 50%, #00733E 75%, #fff 100%); color: #fff; border-radius: 4px; padding: 2px 8px; }
    .filter-text-colorless { background: #e0e0e0; color: #333; border-radius: 4px; padding: 2px 8px; }
  </style>
  <script src="card_prices.js"></script>
</head>
<body>
  <div class="container">
    <div class="color-filter-tray">
      <button class="toggle-button" title="Toggle filter tray"></button>
      <div class="filter-content">
        <label><input type="checkbox" data-color="all" checked /><span>ALL</span></label>
        <label><input type="checkbox" data-color="White" checked /><span class="filter-text filter-text-white">White</span><span class="only-icon" data-color="White" title="Show only White cards">üëÅÔ∏è</span></label>
        <label><input type="checkbox" data-color="Blue" checked /><span class="filter-text filter-text-blue">Blue</span><span class="only-icon" data-color="Blue" title="Show only Blue cards">üëÅÔ∏è</span></label>
        <label><input type="checkbox" data-color="Black" checked /><span class="filter-text filter-text-black">Black</span><span class="only-icon" data-color="Black" title="Show only Black cards">üëÅÔ∏è</span></label>
        <label><input type="checkbox" data-color="Red" checked /><span class="filter-text filter-text-red">Red</span><span class="only-icon" data-color="Red" title="Show only Red cards">üëÅÔ∏è</span></label>
        <label><input type="checkbox" data-color="Green" checked /><span class="filter-text filter-text-green">Green</span><span class="only-icon" data-color="Green" title="Show only Green cards">üëÅÔ∏è</span></label>
        <label><input type="checkbox" data-color="Multicolor" checked /><span class="filter-text filter-text-multicolor">Multicolor</span><span class="only-icon" data-color="Multicolor" title="Show only Multicolor cards">üëÅÔ∏è</span></label>
        <label><input type="checkbox" data-color="Colorless" checked /><span class="filter-text filter-text-colorless">Colorless</span><span class="only-icon" data-color="Colorless" title="Show only Colorless cards">üëÅÔ∏è</span></label>
      </div>
    </div>
    <div>
      <h1>Commander Game Changers List</h1>
      <div style="text-align: center; margin-bottom: 20px;">
        <button id="fetch-all-prices" style="padding: 10px 20px; font-size: 16px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.2s;">Fetch All Prices</button>
        <div id="fetch-status" style="margin-top: 10px; font-style: italic; color: #666;"></div>
      </div>
      <div class="card-grid">
<div class="card" data-colors="white">
  <div class="card-name">DRANNITH MAGISTRATE</div>
  <div class="card-image-container">
    <img src="card_images/479531.jpg" alt="DRANNITH MAGISTRATE">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="white">
  <div class="card-name">ENLIGHTENED TUTOR</div>
  <div class="card-image-container">
    <img src="card_images/598880.jpg" alt="ENLIGHTENED TUTOR">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="white">
  <div class="card-name">HUMILITY</div>
  <div class="card-image-container">
    <img src="card_images/397614.jpg" alt="HUMILITY">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">SERRA'S SANCTUM</div>
  <div class="card-image-container">
    <img src="card_images/9674.jpg" alt="SERRA'S SANCTUM">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="white">
  <div class="card-name">SMOTHERING TITHE</div>
  <div class="card-image-container">
    <img src="card_images/632392.jpg" alt="SMOTHERING TITHE">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="white">
  <div class="card-name">TEFERI'S PROTECTION</div>
  <div class="card-image-container">
    <img src="card_images/571365.jpg" alt="TEFERI'S PROTECTION">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">CYCLONIC RIFT</div>
  <div class="card-image-container">
    <img src="card_images/645410.jpg" alt="CYCLONIC RIFT">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">CONSECRATED SPHINX</div>
  <div class="card-image-container">
    <img src="card_images/573395.jpg" alt="CONSECRATED SPHINX">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">EXPROPRIATE</div>
  <div class="card-image-container">
    <img src="card_images/677358.jpg" alt="EXPROPRIATE">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">FORCE OF WILL</div>
  <div class="card-image-container">
    <img src="card_images/601353.jpg" alt="FORCE OF WILL">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">GUARDIANSHIP</div>
  <div class="card-image-container">
    <img src="card_images/626344.jpg" alt="GUARDIANSHIP">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">GIFTS UNGIVEN</div>
  <div class="card-image-container">
    <img src="card_images/571384.jpg" alt="GIFTS UNGIVEN">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">INTUITION</div>
  <div class="card-image-container">
    <img src="card_images/397633.jpg" alt="INTUITION">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">JIN-GITAXIAS, CORE AUGUR</div>
  <div class="card-image-container">
    <img src="card_images/611316.jpg" alt="JIN-GITAXIAS, CORE AUGUR">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">MYSTICAL TUTOR</div>
  <div class="card-image-container">
    <img src="card_images/600972.jpg" alt="MYSTICAL TUTOR">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">NARSET, PARTER OF VEILS</div>
  <div class="card-image-container">
    <img src="card_images/677708.jpg" alt="NARSET, PARTER OF VEILS">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">RHYSTIC STUDY</div>
  <div class="card-image-container">
    <img src="card_images/632453.jpg" alt="RHYSTIC STUDY">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">SWAY OF THE STARS</div>
  <div class="card-image-container">
    <img src="card_images/74034.jpg" alt="SWAY OF THE STARS">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">THASSA'S ORACLE</div>
  <div class="card-image-container">
    <img src="card_images/677452.jpg" alt="THASSA'S ORACLE">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="blue">
  <div class="card-name">URZA, LORD HIGH ARTIFICER</div>
  <div class="card-image-container">
    <img src="card_images/677521.jpg" alt="URZA, LORD HIGH ARTIFICER">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="black">
  <div class="card-name">AD NAUSEAM</div>
  <div class="card-image-container">
    <img src="card_images/489749.jpg" alt="AD NAUSEAM">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="black">
  <div class="card-name">BRAIDS, CABAL MINION</div>
  <div class="card-image-container">
    <img src="card_images/526244.jpg" alt="BRAIDS, CABAL MINION">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="black">
  <div class="card-name">BOLAS'S CITADEL</div>
  <div class="card-image-container">
    <img src="card_images/677715.jpg" alt="BOLAS'S CITADEL">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="black">
  <div class="card-name">DEMONIC TUTOR</div>
  <div class="card-image-container">
    <img src="card_images/622758.jpg" alt="DEMONIC TUTOR">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="black">
  <div class="card-name">IMPERIAL SEAL</div>
  <div class="card-image-container">
    <img src="card_images/571412.jpg" alt="IMPERIAL SEAL">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="black">
  <div class="card-name">NECROPOTENCE</div>
  <div class="card-image-container">
    <img src="card_images/632459.jpg" alt="NECROPOTENCE">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="black">
  <div class="card-name">OPPOSITION AGENT</div>
  <div class="card-image-container">
    <img src="card_images/502324.jpg" alt="OPPOSITION AGENT">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="black">
  <div class="card-name">ORCISH BOWMASTERS</div>
  <div class="card-image-container">
    <img src="card_images/616933.jpg" alt="ORCISH BOWMASTERS">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="black">
  <div class="card-name">TERGRID, GOD OF FRIGHT</div>
  <div class="card-image-container">
    <img src="card_images/507654.jpg" alt="TERGRID, GOD OF FRIGHT">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="black">
  <div class="card-name">VAMPIRIC TUTOR</div>
  <div class="card-image-container">
    <img src="card_images/600981.jpg" alt="VAMPIRIC TUTOR">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="red">
  <div class="card-name">DEFLECTING SWAT</div>
  <div class="card-image-container">
    <img src="card_images/626387.jpg" alt="DEFLECTING SWAT">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="red">
  <div class="card-name">GAMBLE</div>
  <div class="card-image-container">
    <img src="card_images/651682.jpg" alt="GAMBLE">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="red">
  <div class="card-name">JESKA'S WILL</div>
  <div class="card-image-container">
    <img src="card_images/650250.jpg" alt="JESKA'S WILL">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="red">
  <div class="card-name">UNDERWORLD BREACH</div>
  <div class="card-image-container">
    <img src="card_images/677477.jpg" alt="UNDERWORLD BREACH">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="green">
  <div class="card-name">CROP ROTATION</div>
  <div class="card-image-container">
    <img src="card_images/599028.jpg" alt="CROP ROTATION">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="green">
  <div class="card-name">FOOD CHAIN</div>
  <div class="card-image-container">
    <img src="card_images/571480.jpg" alt="FOOD CHAIN">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">GAEA'S CRADLE</div>
  <div class="card-image-container">
    <img src="card_images/10422.jpg" alt="GAEA'S CRADLE">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="green">
  <div class="card-name">NATURAL ORDER</div>
  <div class="card-image-container">
    <img src="card_images/677487.jpg" alt="NATURAL ORDER">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="green">
  <div class="card-name">SEEDBORN MUSE</div>
  <div class="card-image-container">
    <img src="card_images/696424.jpg" alt="SEEDBORN MUSE">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="green">
  <div class="card-name">SURVIVAL OF THE FITTEST</div>
  <div class="card-image-container">
    <img src="card_images/397535.jpg" alt="SURVIVAL OF THE FITTEST">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="green">
  <div class="card-name">VORINCLEX, VOICE OF HUNGER</div>
  <div class="card-image-container">
    <img src="card_images/611334.jpg" alt="VORINCLEX, VOICE OF HUNGER">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="green">
  <div class="card-name">WORLDLY TUTOR</div>
  <div class="card-image-container">
    <img src="card_images/600993.jpg" alt="WORLDLY TUTOR">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="multicolor,green,white">
  <div class="card-name">AURA SHARDS</div>
  <div class="card-image-container">
    <img src="card_images/247184.jpg" alt="AURA SHARDS">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="multicolor,green,white,red,blue,black">
  <div class="card-name">COALITION VICTORY</div>
  <div class="card-image-container">
    <img src="card_images/109718.jpg" alt="COALITION VICTORY">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="multicolor,blue,green">
  <div class="card-name">KINNAN, BONDER PRODIGY</div>
  <div class="card-image-container">
    <img src="card_images/479712.jpg" alt="KINNAN, BONDER PRODIGY">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="multicolor,white,blue">
  <div class="card-name">GRAND ARBITER AUGUSTIN IV</div>
  <div class="card-image-container">
    <img src="card_images/573041.jpg" alt="GRAND ARBITER AUGUSTIN IV">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="multicolor,blue,black">
  <div class="card-name">NOTION THIEF</div>
  <div class="card-image-container">
    <img src="card_images/660844.jpg" alt="NOTION THIEF">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="multicolor,red,white">
  <div class="card-name">WINOTA, JOINER OF FORCES</div>
  <div class="card-image-container">
    <img src="card_images/479736.jpg" alt="WINOTA, JOINER OF FORCES">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="multicolor,blue,black">
  <div class="card-name">YURIKO, THE TIGER'S SHADOW</div>
  <div class="card-image-container">
    <img src="card_images/627828.jpg" alt="YURIKO, THE TIGER'S SHADOW">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">ANCIENT TOMB</div>
  <div class="card-image-container">
    <img src="card_images/622589.jpg" alt="ANCIENT TOMB">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">CHROME MOX</div>
  <div class="card-image-container">
    <img src="card_images/693158.jpg" alt="CHROME MOX">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">FIELD OF THE DEAD</div>
  <div class="card-image-container">
    <img src="card_images/651686.jpg" alt="FIELD OF THE DEAD">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">GLACIAL CHASM</div>
  <div class="card-image-container">
    <img src="card_images/288996.jpg" alt="GLACIAL CHASM">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">GRIM MONOLITH</div>
  <div class="card-image-container">
    <img src="card_images/12626.jpg" alt="GRIM MONOLITH">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">LION'S EYE DIAMOND</div>
  <div class="card-image-container">
    <img src="card_images/383000.jpg" alt="LION'S EYE DIAMOND">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">MANA VAULT</div>
  <div class="card-image-container">
    <img src="card_images/573056.jpg" alt="MANA VAULT">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">MOX DIAMOND</div>
  <div class="card-image-container">
    <img src="card_images/397482.jpg" alt="MOX DIAMOND">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">MISHRA'S WORKSHOP</div>
  <div class="card-image-container">
    <img src="card_images/383015.jpg" alt="MISHRA'S WORKSHOP">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">PANOPTIC MIRROR</div>
  <div class="card-image-container">
    <img src="card_images/47930.jpg" alt="PANOPTIC MIRROR">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">THE ONE RING</div>
  <div class="card-image-container">
    <img src="card_images/636294.jpg" alt="THE ONE RING">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
<div class="card" data-colors="colorless">
  <div class="card-name">THE TABERNACLE AT PENDRELL VALE</div>
  <div class="card-image-container">
    <img src="card_images/201236.jpg" alt="THE TABERNACLE AT PENDRELL VALE">
  </div>
  <div class="price-info">Click to load prices</div>
</div>
      </div>
      <div class="source">
        Source: <a href="https://magic.wizards.com/en/news/announcements/commander-brackets-beta-update-april-22-2025">Commander Brackets Beta Update - April 22, 2025</a>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const tray = document.querySelector('.color-filter-tray');
      const toggleButton = document.querySelector('.toggle-button');
      const allCheckbox = document.querySelector('input[data-color="all"]');
      const colorCheckboxes = document.querySelectorAll('input[data-color]:not([data-color="all"])');
      const onlyIcons = document.querySelectorAll('.only-icon');
      const cards = document.querySelectorAll('.card');
      const fetchAllButton = document.getElementById('fetch-all-prices');
      const fetchStatus = document.getElementById('fetch-status');
      
      // Function to animate ellipsis
      function animateEllipsis(element, text) {
        let dots = 0;
        const maxDots = 3;
        const interval = setInterval(() => {
          dots = (dots + 1) % (maxDots + 1);
          element.innerHTML = `${text}${'.'.repeat(dots)}`;
        }, 500);
        return interval;
      }

      // Function to fetch prices for a single card
      async function fetchCardPrices(cardElement) {
        const cardName = cardElement.querySelector('.card-name').textContent;
        const priceInfo = cardElement.querySelector('.price-info');
        
        try {
          priceInfo.innerHTML = '<span class="loading">Fetching prices</span>';
          const ellipsisInterval = animateEllipsis(priceInfo.querySelector('.loading'), 'Fetching prices');
          
          const response = await fetch(`http://localhost:4567/card_info?card=${encodeURIComponent(cardName)}`);
          clearInterval(ellipsisInterval);
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.json();
          
          if (data && data.prices) {
            // Cache the prices immediately after successful fetch
            await fetch('http://localhost:4567/cache_prices', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                card: cardName,
                prices: data.prices,
                timestamp: data.timestamp || Math.floor(Date.now() / 1000)
              })
            });

            let html = [];
            if (data.prices['Near Mint']) {
              const nm = data.prices['Near Mint'];
              html.push(`Near Mint: <a href="${data.tcgplayer_url}" target="_blank">$${parseFloat(nm).toFixed(2)}</a>`);
            }
            if (data.prices['Lightly Played']) {
              const lp = data.prices['Lightly Played'];
              html.push(`Lightly Played: <a href="${data.tcgplayer_url}" target="_blank">$${parseFloat(lp).toFixed(2)}</a>`);
                }
            if (data.timestamp) {
              const timestamp = new Date(data.timestamp * 1000);
              const now = new Date();
              const hoursAgo = Math.floor((now - timestamp) / (1000 * 60 * 60));
              let timestampClass = 'recent';
              if (hoursAgo > 24) {
                timestampClass = hoursAgo > 48 ? 'very-old' : 'old';
              }
              html.push(`<span class="price-timestamp ${timestampClass}">Updated ${hoursAgo} hours ago</span>`);
            }
            priceInfo.innerHTML = html.join(' | ') || 'No prices found';
          } else {
            priceInfo.innerHTML = 'No prices found';
          }
        } catch (error) {
          console.error('Error fetching prices for', cardName, ':', error);
          priceInfo.innerHTML = 'Click to load prices';
        }
      }
      
      // Function to fetch all prices
      async function fetchAllPrices() {
        if (fetchAllButton.disabled) return; // Prevent multiple clicks
        
        fetchAllButton.disabled = true;
        fetchAllButton.style.backgroundColor = '#999';
        fetchStatus.textContent = 'Fetching prices';
        let ellipsisInterval = animateEllipsis(fetchStatus, 'Fetching prices');
        
        const cardElements = Array.from(cards);
        let completed = 0;
        let failed = 0;
        
        // Process cards one at a time
        for (const card of cardElements) {
          try {
            await fetchCardPrices(card);
            completed++;
          } catch (error) {
            console.error('Error fetching prices for card:', error);
            failed++;
          }
          clearInterval(ellipsisInterval);
          fetchStatus.textContent = `Fetched ${completed} cards${failed > 0 ? `, ${failed} failed` : ''}...`;
          ellipsisInterval = animateEllipsis(fetchStatus, `Fetched ${completed} cards${failed > 0 ? `, ${failed} failed` : ''}`);
          // Add a small delay between cards to avoid rate limiting
          await new Promise(resolve => setTimeout(resolve, 1000));
        }
        clearInterval(ellipsisInterval);
        fetchStatus.textContent = `Completed: ${completed} cards fetched${failed > 0 ? `, ${failed} failed` : ''}`;
        fetchAllButton.disabled = false;
      }
      
      // Add click handler for the fetch all button
      fetchAllButton.addEventListener('click', fetchAllPrices);
      
      // Function to update card visibility based on selected colors
      function updateCardVisibility() {
        // First, remove all visibility classes
        cards.forEach(card => {
          card.classList.remove('hidden-by-color');
          card.classList.remove('hidden-by-all');
        });
        
        // If ALL is checked, we're done - all cards are visible
        if (allCheckbox.checked) {
          return;
        }
        
        // Otherwise, apply color filtering
        const selectedColors = Array.from(colorCheckboxes)
          .filter(cb => cb.checked)
          .map(cb => cb.dataset.color.toLowerCase());
        
        cards.forEach(card => {
          const cardColors = card.dataset.colors.split(',');
          // Special handling for Multicolor cards
          const shouldShow = selectedColors.some(color => {
            if (color === 'multicolor') {
              return cardColors.includes('multicolor');
            } else {
              return cardColors.includes(color);
            }
          });
          if (!shouldShow) {
            card.classList.add('hidden-by-color');
          }
        });
      }
      
      // Handle ALL checkbox
      allCheckbox.addEventListener('change', function() {
        // When ALL is checked, remove all visibility classes
        if (this.checked) {
          cards.forEach(card => {
            card.classList.remove('hidden-by-color');
            card.classList.remove('hidden-by-all');
          });
        } else {
          // When ALL is unchecked, update based on color checkboxes
          updateCardVisibility();
        }
      });
      
      // Handle individual color checkboxes
      colorCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          // When any color checkbox changes, uncheck ALL
          allCheckbox.checked = false;
          // Update visibility based on color checkboxes
          updateCardVisibility();
        });
      });
      
      // Handle "only" icons
      onlyIcons.forEach(icon => {
        icon.addEventListener('click', function(e) {
          e.stopPropagation(); // Prevent label click
          const color = this.dataset.color.toLowerCase();
          
          // Uncheck ALL
          allCheckbox.checked = false;
          
          // Uncheck all colors except the clicked one
          colorCheckboxes.forEach(cb => {
            // For Multicolor cards, we need to check if the card has "multicolor" in its colors
            if (color === 'multicolor') {
              cb.checked = cb.dataset.color.toLowerCase() === color;
            } else {
              cb.checked = cb.dataset.color.toLowerCase() === color;
            }
          });
          
          // Update visibility
          updateCardVisibility();
        });
      });
      
      // Toggle tray
      toggleButton.addEventListener('click', function() {
        tray.classList.toggle('collapsed');
      });
      
      // Initial visibility update
      updateCardVisibility();
    });
  </script>
</body>
</html>
